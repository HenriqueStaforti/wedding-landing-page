---
interface Props {
  priceNumber: number;
}

const { priceNumber } = Astro.props;

// Format price for PIX display (in centavos)
const formattedPrice = (priceNumber / 100).toLocaleString("pt-BR", {
  style: "currency",
  currency: "BRL",
});
---

<div class="text-center">
  <h3
    class="mb-6 text-xl font-semibold"
    style="color: var(--color-primary);"
  >
    Pagar com PIX
  </h3>

  <!-- QR Code Container -->
  <div class="mb-6 flex justify-center">
    <div
      class="rounded-lg p-4"
      style="background-color: var(--color-background);"
    >
      <!-- Static QR Code - You can replace with dynamic generation -->
      <img
        id="qr-code"
        src="https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=00020126580014br.bcb.brcode01051.0.063047A33DB57F6554CBF4B3F5D6E9D80520400005303986540510.005802BR5913CASAL TESTE6009SAO PAULO62410503***63041D3D"
        alt="QR Code PIX"
        class="h-64 w-64"
      />
    </div>
  </div>

  <!-- Amount Display -->
  <div class="mb-6">
    <p
      class="mb-2 text-sm"
      style="color: color-mix(in srgb, var(--color-primary), transparent 50%);"
    >
      Valor a transferir:
    </p>
    <p
      class="text-3xl font-bold"
      style="color: var(--color-accent);"
    >
      {formattedPrice}
    </p>
  </div>

  <!-- Instructions -->
  <div
    class="rounded-lg p-4"
    style="background-color: color-mix(in srgb, var(--color-accent), transparent 90%);"
  >
    <p
      class="text-sm leading-relaxed"
      style="color: color-mix(in srgb, var(--color-accent), var(--color-primary));"
    >
      1. Abra o aplicativo do seu banco<br />
      2. Selecione a opção PIX<br />
      3. Escaneie o QR Code acima ou copie a chave<br />
      4. Confirme os dados e digite sua senha
    </p>
  </div>

  <!-- Copy Button (for manual entry) -->
  <button
    id="copy-pix-key"
    class="mt-6 w-full rounded-lg px-6 py-3 font-semibold transition-all duration-200"
    style="background-color: var(--color-accent); color: var(--color-text-light);"
  >
    Copiar Chave PIX
  </button>
</div>

<script>
  const copyBtn = document.getElementById("copy-pix-key");
  const pixKey = "00020126580014br.bcb.brcode01051.0.063047A33DB57F6554CBF4B3F5D6E9D80520400005303986540510.005802BR5913CASAL TESTE6009SAO PAULO62410503***63041D3D";

  copyBtn?.addEventListener("click", async () => {
    try {
      await navigator.clipboard.writeText(pixKey);
      const originalText = copyBtn.textContent;
      copyBtn.textContent = "✓ Copiado!";
      setTimeout(() => {
        copyBtn.textContent = originalText;
      }, 2000);
    } catch (err) {
      console.error("Falha ao copiar:", err);
    }
  });
</script>
